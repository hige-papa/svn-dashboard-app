# å®Ÿè£…è¨ˆç”»æ›¸ï¼šé€±æ¬¡ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ®µéšçš„ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨è¡¨ç¤ºæœ€é©åŒ–

## ğŸ“… ä½œæˆæ—¥: 2025å¹´10æœˆ24æ—¥
## ğŸ¯ ç›®çš„
é€±æ¬¡ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®èµ·å‹•é€Ÿåº¦ã‚’æ”¹å–„ã—ã€DailyOptionãªã—ã§ã‚‚ä¸»è¦æ©Ÿèƒ½ã‚’ä½¿ç”¨å¯èƒ½ã«ã™ã‚‹ã€‚

---

## ğŸ“‹ å®Ÿè£…æ–¹é‡

### åŸºæœ¬æ–¹é‡
1. **é‡è¤‡å–å¾—ã®é˜²æ­¢**: `useDailyOptions.ts`ã®è‡ªå‹•å–å¾—ã‚’åœæ­¢ã—ã€`useCalendar.ts`ã‹ã‚‰åˆ¶å¾¡
2. **æ®µéšçš„ãƒ‡ãƒ¼ã‚¿å–å¾—**: 3ãƒ•ã‚§ãƒ¼ã‚ºã«åˆ†ã‘ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»è¡¨ç¤º
3. **Firebaseã‚¯ã‚¨ãƒªæœ€é©åŒ–**: ã‚¯ã‚¨ãƒªå›æ•°ã‚’å¢—ã‚„ã•ãšã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§åˆæœŸè¡¨ç¤ºã‚’é«˜é€ŸåŒ–
4. **ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…**: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã¯å˜ä¸€ãƒ•ãƒ©ã‚°ã€ãƒ‡ãƒ¼ã‚¿æœ‰ç„¡ã§åˆ¤å®š

---

## ğŸ”§ å®Ÿè£…è©³ç´°

### ãƒ•ã‚§ãƒ¼ã‚º1: åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã®å³æ™‚è¡¨ç¤º
**ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œå¯èƒ½ãªæœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿ã‚’å³åº§ã«è¡¨ç¤º

**å®Ÿè£…å†…å®¹**:
1. **è‡ªèº«ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**
   - `getCachedMyEvents(uid, dateRange)`: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰è‡ªèº«ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—
   - `setCachedMyEvents(uid, events)`: è‡ªèº«ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   - TTL: 30åˆ†ï¼ˆ1800ç§’ï¼‰

2. **å„ªå…ˆãƒ‡ãƒ¼ã‚¿å–å¾—**
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸè‡ªèº«ã®ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã‚ã‚Œã°å³è¡¨ç¤ºï¼‰
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒã‚¹ã‚¿ãƒ¼ï¼ˆæ—¢å­˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹ä½¿ç”¨ï¼‰
   - ç¥æ—¥ãƒã‚¹ã‚¿ãƒ¼ï¼ˆæ—¢å­˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹ä½¿ç”¨ï¼‰

**æœŸå¾…çµæœ**:
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆæ™‚: 0.1ç§’ä»¥å†…ã«è‡ªèº«ã®äºˆå®šãŒè¡¨ç¤º
- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ ã¨è‡ªèº«ã®äºˆå®šãŒæ“ä½œå¯èƒ½

---

### ãƒ•ã‚§ãƒ¼ã‚º2: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã®å–å¾—
**ç›®çš„**: ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®äºˆå®šã‚’è¿½åŠ è¡¨ç¤º

**å®Ÿè£…å†…å®¹**:
1. `setTimeout(0)` ã§éåŒæœŸå®Ÿè¡Œ
2. `eventService.getEventsInRange()` ã§å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ï¼ˆç¾çŠ¶ã¨åŒã˜ï¼‰
3. `events.value` ã‚’ä¸Šæ›¸ãæ›´æ–°
4. è‡ªèº«ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜

**æœŸå¾…çµæœ**:
- ãƒ•ã‚§ãƒ¼ã‚º1ã®è¡¨ç¤ºå¾Œã€0.5ã€œ1ç§’ã§ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®äºˆå®šãŒè¿½åŠ è¡¨ç¤º
- Firebaseã‚¯ã‚¨ãƒªã¯1å›ã®ã¿ï¼ˆèª²é‡‘å¢—ãªã—ï¼‰

---

### ãƒ•ã‚§ãƒ¼ã‚º3: DailyOptionã®å–å¾—
**ç›®çš„**: å„ªå…ˆåº¦ã®ä½ã„DailyOptionã‚’æœ€å¾Œã«å–å¾—

**å®Ÿè£…å†…å®¹**:
1. `setTimeout(100)` ã§é…å»¶å®Ÿè¡Œ
2. `useDailyOptions`ã®`loadDailyOptions()`ã‚’æ˜ç¤ºçš„ã«å‘¼ã³å‡ºã™
3. `dailyOptions.value` ã‚’æ›´æ–°

**æœŸå¾…çµæœ**:
- ä¸»è¦æ©Ÿèƒ½ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤ºãƒ»æ“ä½œï¼‰ã«å½±éŸ¿ã‚’ä¸ãˆãªã„
- DailyOptionãŒãªãã¦ã‚‚ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¯å®Œå…¨ã«æ“ä½œå¯èƒ½

---

## ğŸ“ ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

### 1. `composables/useCalendar.ts`
**å¤‰æ›´å†…å®¹**:
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®è¿½åŠ 
  - `getCachedMyEvents()` é–¢æ•°
  - `setCachedMyEvents()` é–¢æ•°
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼: `my-events-cache:${uid}:${startDate}:${endDate}`
  - TTL: 30åˆ†

- [ ] `loadData()` é–¢æ•°ã®æ®µéšçš„å®Ÿè£…
  ```typescript
  // ãƒ•ã‚§ãƒ¼ã‚º1: åŸºæœ¬ãƒ‡ãƒ¼ã‚¿
  const cachedEvents = getCachedMyEvents(currentUser.uid, dateRange);
  if (cachedEvents) {
    events.value = cachedEvents;
  }
  const [usersResult, holidaysResult] = await Promise.all([
    getMasterDataCacheAsync('users'),
    getMasterDataCacheAsync('holidays'),
  ]);
  
  // ãƒ•ã‚§ãƒ¼ã‚º2: å…¨ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
  setTimeout(async () => {
    const allEvents = await eventService.getEventsInRange(dateRange);
    events.value = allEvents;
    setCachedMyEvents(currentUser.uid, allEvents);
  }, 0);
  
  // ãƒ•ã‚§ãƒ¼ã‚º3: DailyOptionï¼ˆæœ€ä½å„ªå…ˆåº¦ï¼‰
  setTimeout(async () => {
    await loadDailyOptionsFunction();
  }, 100);
  ```

- [ ] dailyOptionsã®å–å¾—ãƒ»ç®¡ç†æ©Ÿèƒ½ã‚’è¿½åŠ 
  - `useDailyOptions`ã‚’å†…éƒ¨ã§ä½¿ç”¨
  - `dailyOptions` refã‚’å…¬é–‹
  - `loadDailyOptionsFunction()` ã‚’å®Ÿè£…

### 2. `composables/useDailyOptions.ts`
**å¤‰æ›´å†…å®¹**:
- [ ] è‡ªå‹•å–å¾—ã®åœæ­¢
  ```typescript
  // å‰Šé™¤: onMounted(loadDailyOptions);
  // å‰Šé™¤: watch([currentDate, currentView], loadDailyOptions, { deep: true });
  ```

- [ ] æ‰‹å‹•ãƒ¢ãƒ¼ãƒ‰ã®æ˜ç¢ºåŒ–
  - ã‚³ãƒ¡ãƒ³ãƒˆã§ã€Œå¤–éƒ¨ã‹ã‚‰æ˜ç¤ºçš„ã«å‘¼ã³å‡ºã™ã€ã“ã¨ã‚’è¨˜è¼‰

### 3. `pages/calendar/index.vue`
**å¤‰æ›´å†…å®¹**:
- [ ] `useDailyOptions`ã®å‘¼ã³å‡ºã—ã‚’å‰Šé™¤
- [ ] `useCalendar`ã‹ã‚‰`dailyOptions`ã‚’å–å¾—
  ```typescript
  const {
    // ...æ—¢å­˜
    dailyOptions, // è¿½åŠ 
  } = useCalendar();
  ```

- [ ] `useDailyOptions`ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰Šé™¤

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨ˆç”»

### ãƒ†ã‚¹ãƒˆ1: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ï¼ˆåˆå›ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
**æ‰‹é †**:
1. ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
2. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
3. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
```
[Phase1] Loading basic data...
[Phase1] No cached events found
[Phase1] Basic data loaded (users, holidays)
[Phase2] Loading all events...
[Phase2] All events loaded and cached
[Phase3] Loading daily options...
[Phase3] Daily options loaded
```

### ãƒ†ã‚¹ãƒˆ2: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Šï¼ˆ2å›ç›®ä»¥é™ï¼‰
**æ‰‹é †**:
1. åˆå›ã‚¢ã‚¯ã‚»ã‚¹å¾Œã€ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
2. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
```
[Phase1] Loading basic data...
[Phase1] Cached events found - displaying immediately
[Phase1] Basic data loaded (users, holidays)
[Phase2] Loading all events...
[Phase2] All events loaded and cached
[Phase3] Loading daily options...
[Phase3] Daily options loaded
```

### ãƒ†ã‚¹ãƒˆ3: æ“ä½œæ€§ã®ç¢ºèª
**æ‰‹é †**:
1. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ•ã‚§ãƒ¼ã‚º1å®Œäº†å¾Œã™ãã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã‚’è©¦è¡Œ

**æœŸå¾…çµæœ**:
- ãƒ•ã‚§ãƒ¼ã‚º1å®Œäº†æ™‚ç‚¹ã§å…¨æ“ä½œãŒå¯èƒ½
- DailyOptionãªã—ã§ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²å¯èƒ½

### ãƒ†ã‚¹ãƒˆ4: é‡è¤‡å–å¾—ã®ç¢ºèª
**æ‰‹é †**:
1. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã‚’é–‹ã
2. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
3. Firestoreã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã‚’ç¢ºèª

**æœŸå¾…çµæœ**:
- `daily_user_options`ã¸ã®ã‚¯ã‚¨ãƒªãŒ1å›ã®ã¿
- `events`ã¸ã®ã‚¯ã‚¨ãƒªãŒ1å›ã®ã¿

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™

| æŒ‡æ¨™ | ç¾çŠ¶ | ç›®æ¨™ | æ¸¬å®šæ–¹æ³• |
|------|------|------|----------|
| åˆæœŸè¡¨ç¤ºæ™‚é–“ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Šï¼‰ | - | < 0.5ç§’ | ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— |
| åˆæœŸè¡¨ç¤ºæ™‚é–“ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã—ï¼‰ | - | < 1.5ç§’ | ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— |
| æ“ä½œå¯èƒ½ã¾ã§ã®æ™‚é–“ | - | < 0.5ç§’ | ãƒ•ã‚§ãƒ¼ã‚º1å®Œäº†æ™‚é–“ |
| Firestoreã‚¯ã‚¨ãƒªæ•°ï¼ˆeventsï¼‰ | 1å› | 1å› | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ– |
| Firestoreã‚¯ã‚¨ãƒªæ•°ï¼ˆdailyOptionsï¼‰ | 2å› | 1å› | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ– |

---

## ğŸš¨ ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### ãƒªã‚¹ã‚¯1: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ•´åˆæ€§
**å•é¡Œ**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆãŒå¤ã„å¯èƒ½æ€§
**å¯¾ç­–**: 
- TTLã‚’30åˆ†ã«è¨­å®šï¼ˆçŸ­ã‚ã«ï¼‰
- ãƒ•ã‚§ãƒ¼ã‚º2ã§å¿…ãšæœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»ä¸Šæ›¸ã

### ãƒªã‚¹ã‚¯2: UIã® flickering
**å•é¡Œ**: ãƒ•ã‚§ãƒ¼ã‚º1â†’ãƒ•ã‚§ãƒ¼ã‚º2ã®åˆ‡ã‚Šæ›¿ãˆæ™‚ã«ãƒãƒ©ã¤ã
**å¯¾ç­–**:
- Vueã®å·®åˆ†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«ä¾å­˜
- å¤‰æ›´ãŒãªã„éƒ¨åˆ†ã¯å†æç”»ã•ã‚Œãªã„

### ãƒªã‚¹ã‚¯3: useDailyOptionsã®ä¾å­˜é–¢ä¿‚
**å•é¡Œ**: ä»–ã®ãƒšãƒ¼ã‚¸ã§`useDailyOptions`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å¯èƒ½æ€§
**å¯¾ç­–**:
- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒšãƒ¼ã‚¸ã®ã¿ä¿®æ­£
- ä»–ãƒšãƒ¼ã‚¸ã§ã®ä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèª

---

## ğŸ“ å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

- [x] å®Ÿè£…è¨ˆç”»æ›¸ã®ä½œæˆ
- [x] useDailyOptions.tsã®è‡ªå‹•å–å¾—åœæ­¢
- [x] ã‚¤ãƒ™ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å®Ÿè£…
- [x] loadDataé–¢æ•°ã®ãƒ•ã‚§ãƒ¼ã‚º1å®Ÿè£…
- [x] loadDataé–¢æ•°ã®ãƒ•ã‚§ãƒ¼ã‚º2å®Ÿè£…
- [x] loadDataé–¢æ•°ã®ãƒ•ã‚§ãƒ¼ã‚º3å®Ÿè£…
- [x] pages/calendar/index.vueã®ä¿®æ­£
- [x] Phase1ã«dailyOptionsã‚­ãƒ£ãƒƒã‚·ãƒ¥åŒæœŸãƒã‚§ãƒƒã‚¯è¿½åŠ ï¼ˆæœ€é©åŒ–ï¼‰
- [ ] å‹•ä½œç¢ºèªã¨ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¿½åŠ 
- [ ] æœ€çµ‚ãƒ†ã‚¹ãƒˆã¨å®Ÿè£…è¨ˆç”»æ›¸ã®æ›´æ–°

---

## ğŸ“… å¤‰æ›´å±¥æ­´

### 2025-10-24 åˆç‰ˆä½œæˆ
- å®Ÿè£…è¨ˆç”»ã‚’ç­–å®š
- 3ãƒ•ã‚§ãƒ¼ã‚ºã®æ®µéšçš„å–å¾—æ–¹é‡ã‚’æ±ºå®š
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®ä»•æ§˜ã‚’å®šç¾©

### 2025-10-24 æ®µéšçš„ãƒ‡ãƒ¼ã‚¿å–å¾—ã®å®Ÿè£…å®Œäº†
- useDailyOptions.tsã®è‡ªå‹•å–å¾—ã‚’åœæ­¢ã—é‡è¤‡å–å¾—ã‚’é˜²æ­¢
- ã‚¤ãƒ™ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã‚’è¿½åŠ ï¼ˆlocalStorageã€TTL 30åˆ†ï¼‰
- loadDataé–¢æ•°ã‚’3ãƒ•ã‚§ãƒ¼ã‚ºã«åˆ†å‰²ã—ã¦å®Ÿè£…å®Œäº†

### 2025-10-24 DailyOptionsã‚­ãƒ£ãƒƒã‚·ãƒ¥å³æ™‚è¡¨ç¤ºã®æœ€é©åŒ–
- Phase1ã«dailyOptionsã®åŒæœŸã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ 
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆæ™‚ã¯å³åº§ã«dailyOptionsã‚’è¡¨ç¤º
- Phase3ã¯ç¶™ç¶šã—ã¦ã‚µãƒ¼ãƒãƒ¼ã®æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã§æ•´åˆæ€§ã‚’ä¿è¨¼
- Firestoreã‚¯ã‚¨ãƒªæ•°ã¯ä¸å¤‰ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹æ™‚ã®ã¿å•ã„åˆã‚ã›ï¼‰
